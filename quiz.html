<head>
    <link href="https://fonts.googleapis.com/css?family=Montserrat:300,400,700|Roboto:400,700" rel="stylesheet">
    <link href='style.css' rel='stylesheet' type='text/css'>
    <title>Pestikone - Ilves26</title>
    <link rel="icon" type="x-icon" href="icon.png">
    <link rel="shortcut icon" type="x-icon" href="icon.png">
    <meta charset="utf-8">
</head>
<body>
    <script type="application/javascript"
            src="questions.js">
    </script>
    <h1>Pestikone - Ilves26</h1>
    <hr>
    <h2 style="text-align:center;" id="question-number">Lataa...</h2>
    <p class="question" id="question-text"></p>
    <button class="button stronglyAgree" onclick="next_question( 1.0)">Vahvasti samaa mieltä</button> <br>
    <button class="button agree" onclick="next_question( 0.5)">Samaa mieltä</button> <br>
    <button class="button neutral" onclick="next_question( 0.0)">Neutraali tai epävarma</button> <br>
    <button class="button disagree" onclick="next_question(-0.5)">Eri mieltä</button> <br>
    <button class="button stronglyDisagree" onclick="next_question(-1.0)">Vahvasti eri mieltä</button> <br>
    <button class="small_button" onclick="prev_question()" id="back_button">Takaisin</button>
    <button class="small_button_off" id="back_button_off">Takaisin</button><br>

    <script>
        var max_myynti, max_palvelu, max_ohjelma, max_some, max_huolto, max_tekniikka, max_liikenne, max_elintarvike; // Max possible scores
        max_myynti = max_palvelu = max_ohjelma = max_some = max_huolto = max_tekniikka = max_liikenne = max_elintarvike = 0;
        let myynti_array = new Array(questions.length);
        let palvelu_array = new Array(questions.length);
        let ohjelma_array = new Array(questions.length);
        let some_array = new Array(questions.length);
        let huolto_array = new Array(questions.length);
        let tekniikka_array = new Array(questions.length);
        let liikenne_array = new Array(questions.length);
        let elintarvike_array = new Array(questions.length);
        var qn = 0; // Question number
        init_question();
        for (var i = 0; i < questions.length; i++) {
            max_myynti += Math.abs(questions[i].effect.myynti)
            max_palvelu += Math.abs(questions[i].effect.palvelu)
            max_ohjelma += Math.abs(questions[i].effect.ohjelma)
            max_some += Math.abs(questions[i].effect.some)
            max_huolto += Math.abs(questions[i].effect.huolto)
            max_tekniikka += Math.abs(questions[i].effect.tekniikka)
            max_liikenne += Math.abs(questions[i].effect.liikenne)
            max_elintarvike += Math.abs(questions[i].effect.elintarvike)
        }
        function init_question() {
            document.getElementById("question-text").innerHTML = questions[qn].question;
            document.getElementById("question-number").innerHTML = "Question " + (qn + 1) + " of " + (questions.length);
            if (qn == 0) {
                document.getElementById("back_button").style.display = 'none';
                document.getElementById("back_button_off").style.display = 'block';
            } else {
                document.getElementById("back_button").style.display = 'block';
                document.getElementById("back_button_off").style.display = 'none';
            }

        }

        function next_question(mult) {
            myynti_array[qn] = mult*questions[qn].effect.myynti
            palvelu_array[qn] = mult*questions[qn].effect.palvelu
            ohjelma_array[qn] = mult*questions[qn].effect.ohjelma
            some_array[qn] = mult*questions[qn].effect.some
            huolto_array[qn] = mult*questions[qn].effect.huolto
            tekniikka_array[qn] = mult*questions[qn].effect.tekniikka
            liikenne_array[qn] = mult*questions[qn].effect.liikenne
            elintarvike_array[qn] = mult*questions[qn].effect.elintarvike

            qn++;
            if (qn < questions.length) {
                init_question();
            } else {
                results();
            }
        }

        function prev_question() {
            if (qn == 0) {
                return;
            }
            qn--;
            init_question();
        }

        function calc_score(score,max) {
            return (100*(max+score)/(2*max)).toFixed(1)
        }

        function results() {
            let final_myynti = myynti_array.reduce((a, b) => a + b, 0)
            let final_palvelu = palvelu_array.reduce((a, b) => a + b, 0)
            let final_ohjelma = ohjelma_array.reduce((a, b) => a + b, 0)
            let final_some = some_array.reduce((a, b) => a + b, 0)
            let final_huolto = huolto_array.reduce((a, b) => a + b, 0)
            let final_tekniikka = tekniikka_array.reduce((a, b) => a + b, 0)
            let final_liikenne = liikenne_array.reduce((a, b) => a + b, 0)
            let final_elintarvike = elintarvike_array.reduce((a, b) => a + b, 0)

            location.href = `results.html`
                + `?m=${calc_score(final_myynti,max_myynti)}`
                + `&p=${calc_score(final_palvelu,max_palvelu)}`
                + `&o=${calc_score(final_ohjelma,max_ohjelma)}`
                + `&s=${calc_score(final_some,max_some)}`
                + `&h=${calc_score(final_huolto,max_huolto)}`
                + `&t=${calc_score(final_tekniikka,max_tekniikka)}`
                + `&l=${calc_score(final_liikenne,max_liikenne)}`
                + `&e=${calc_score(final_elintarvike,max_elintarvike)}`
        }
    </script>
</body>
